---
const { portfolioname, description } = Astro.props;
---

<div>
  <div class="hidden md:block w-72"></div>
  <aside
    class="hidden fixed overflow-y-auto md:flex items-center flex-col w-72 p-6 h-screen bg-[var(--accent-primary)] bg-[var(--layout-accent)] text-[var(--text-primary)]"
  >
    <h1 class="text-xl font-bold">{portfolioname}</h1>

    <div
      class="w-36 h-36 rounded-full flex-shrink-0 border-4 border-[var(--text-primary)] m-4 bg-cover bg-center"
      style="background-image: var(--accent-img);"
    >
    </div>
    <p
      class="text-sm text-[var(--theme-secondary)] leading-relaxed text-justify"
    >
      {description}
    </p>
    <button
      class="hire-me mt-4 px-4 py-2 bg-[var(--text-primary)] text-[var(--color-primary)] rounded hover:bg-[var(--accent-secondary-hover)] transition"
      type="button"
      data-modal="desktop"
    >
      <i class="fa-solid fa-handshake"></i> Hire Me
    </button>

    <div class="flex items-center w-full justify-evenly mt-4">
      <a
        href="https://github.com/theabhisheksrivastav"
        target="_blank"
        class="hover:text-[var(--accent-secondary)] transition"
      >
        <i class="fa-brands fa-github-alt text-2xl"></i>
      </a>
      <a
        href="https://www.linkedin.com/in/theabhisheksrivastav"
        target="_blank"
        class="hover:text-[var(--accent-secondary)] transition"
      >
        <i class="fa-brands fa-linkedin text-2xl"></i>
      </a>
      <a
        href="https://https://www.youtube.com/@thedevdharma"
        target="_blank"
        class="hover:text-[var(--accent-secondary)] transition"
      >
        <i class="fa-brands fa-youtube text-2xl"></i>
      </a>
      <a
        href="https://www.instagram.com/theabhisheksrivastav"
        target="_blank"
        class="hover:text-[var(--accent-secondary)] transition"
      >
        <i class="fa-brands fa-instagram text-2xl"></i>
      </a>
    </div>

    <nav
      class="mt-6 font-bold flex items-center flex-col gap-2 w-full text-justify-start"
    >
      <a
        href="#about"
        class="px-3 py-2 rounded hover:text-[var(--accent-secondary)] transition"
        ><i class="fa-solid fa-user-astronaut"></i> About Me</a
      >
      <a
        href="#portfolio"
        class="px-3 py-2 rounded hover:text-[var(--accent-secondary)] transition"
        ><i class="fa-solid fa-laptop-code"></i> Portfolio</a
      >
      <a
        href="#services"
        class="px-3 py-2 rounded hover:text-[var(--accent-secondary)] transition"
        ><i class="fa-solid fa-briefcase"></i> Services</a
      >
      <a
        href="#resume"
        class="px-3 py-2 rounded hover:text-[var(--accent-secondary)] transition"
        ><i class="fa-solid fa-book"></i> Resume</a
      >
      <a
        href="#blog"
        class="px-3 py-2 rounded hover:text-[var(--accent-secondary)] transition"
        ><i class="fa-solid fa-blog"></i> Blog</a
      >
      <a
        href="#contact"
        class="px-3 py-2 rounded hover:text-[var(--accent-secondary)] transition"
        ><i class="fa-solid fa-id-card"></i> Contact</a
      >

      <div class="flex flex-col items-center mt-4 gap-4">
        <label
          for="layout-switch"
          class="relative inline-flex items-center cursor-pointer"
        >
          <!-- hidden checkbox -->
          <input
            type="checkbox"
             id="layout-switch"
            class="sr-only peer layout-switch"
          />

          <!-- background track -->
          <div
            class="w-12 h-6 bg-gray-300 rounded-full shadow-inner transition-colors duration-300 ease-in-out peer-checked:bg-gray-800"
          >
          </div>

          <!-- toggle knob -->
          <div
            class="absolute left-0.5 top-0.5 w-5 h-5 bg-[var(--accent-primary)] rounded-full shadow transform transition-transform duration-300 ease-in-out peer-checked:translate-x-6"
          >
          </div>
        </label>
        <span class="text-sm text-[var(--text-primary)]">Dark Mode</span>
      </div>
    </nav>
  </aside>
  <header
    class="md:hidden bg-[var(--accent-primary)] bg-[var(--layout-accent)] text-[var(--text-primary)] border-b border-[var(--color-secondary)]"
  >
    <div class="flex items-center justify-start gap-12 p-4">
      <!-- Hamburger toggle -->
      <button
        id="mobile-toggle"
        class="p-2 rounded hover:bg-[var(--accent-secondary)] transition"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
      <span class="text-xl font-bold">{portfolioname}</span>
    </div>

    <!-- Collapsible menu -->
    <nav
      id="mobile-menu"
      class="flex flex-col gap-2 p-4 border-t border-[var(--color-secondary)] hidden"
    >
      <div class="flex flex-col items-center">
        <!-- <h1 class="text-xl font-bold">{portfolioname}</h1> -->

        <div
          class="w-36 h-36 rounded-full flex-shrink-0 border-4 border-[var(--text-primary)] m-4 bg-cover bg-center"
          style="background-image: var(--accent-img);"
        >
        </div>
        <p
          class="text-sm text-[var(--theme-secondary)] leading-relaxed text-justify"
        >
          {description}
        </p>
        <button
          class="hire-me mt-4 px-4 py-2 bg-[var(--text-primary)] text-[var(--color-primary)] rounded hover:bg-[var(--accent-secondary-hover)] transition"
        >
          <i class="fa-solid fa-handshake"></i> Hire Me
        </button>

        <div class="flex items-center w-full justify-evenly mt-4">
          <a
            href="https://github.com/theabhisheksrivastav"
            target="_blank"
            class="hover:text-[var(--accent-secondary)] transition"
          >
            <i class="fa-brands fa-github-alt text-2xl"></i>
          </a>
          <a
            href="https://www.linkedin.com/in/theabhisheksrivastav"
            target="_blank"
            class="hover:text-[var(--accent-secondary)] transition"
          >
            <i class="fa-brands fa-linkedin text-2xl"></i>
          </a>
          <a
            href="https://https://www.youtube.com/@thedevdharma"
            target="_blank"
            class="hover:text-[var(--accent-secondary)] transition"
          >
            <i class="fa-brands fa-youtube text-2xl"></i>
          </a>
          <a
            href="https://www.instagram.com/theabhisheksrivastav"
            target="_blank"
            class="hover:text-[var(--accent-secondary)] transition"
          >
            <i class="fa-brands fa-instagram text-2xl"></i>
          </a>
        </div>

        <nav
          class="mt-6 font-bold flex items-center flex-col gap-2 w-full text-justify-start"
        >
          <a
            href="#about"
            class="px-3 py-2 rounded hover:text-[var(--accent-secondary)] transition"
            ><i class="fa-solid fa-user-astronaut"></i> About Me</a
          >
          <a
            href="#portfolio"
            class="px-3 py-2 rounded hover:text-[var(--accent-secondary)] transition"
            ><i class="fa-solid fa-laptop-code"></i> Portfolio</a
          >
          <a
            href="#services"
            class="px-3 py-2 rounded hover:text-[var(--accent-secondary)] transition"
            ><i class="fa-solid fa-briefcase"></i> Services</a
          >
          <a
            href="#resume"
            class="px-3 py-2 rounded hover:text-[var(--accent-secondary)] transition"
            ><i class="fa-solid fa-book"></i> Resume</a
          >
          <a
            href="#blog"
            class="px-3 py-2 rounded hover:text-[var(--accent-secondary)] transition"
            ><i class="fa-solid fa-blog"></i> Blog</a
          >
          <a
            href="#contact"
            class="px-3 py-2 rounded hover:text-[var(--accent-secondary)] transition"
            ><i class="fa-solid fa-id-card"></i> Contact</a
          >

          <div class="flex flex-col items-center mt-4 gap-4">
            <label
              for="layout-switch"
              class="relative inline-flex items-center cursor-pointer"
            >
              <!-- hidden checkbox -->
              <input
                type="checkbox"
                 id="layout-switch"
                class="sr-only peer layout-switch"
              />

              <!-- background track -->
              <div
                class="w-12 h-6 bg-gray-300 rounded-full shadow-inner transition-colors duration-300 ease-in-out peer-checked:bg-gray-800"
              >
              </div>

              <!-- knob -->
              <div
                class="absolute left-0.5 top-0.5 w-5 h-5 bg-[var(--accent-primary)] rounded-full shadow transform transition-transform duration-300 ease-in-out peer-checked:translate-x-6"
              >
              </div>
            </label>
            <span class="text-sm text-[var(--text-primary)]">Dark Mode</span>
          </div>
        </nav>
      </div>
    </nav>
  </header>
  <!-- Hire Me Modal -->
  <div
    id="hire-modal"
    class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50 p-4"
  >
    <div
      class="bg-white dark:bg-gray-900 p-6 rounded-lg shadow-xl w-full max-w-lg relative overflow-y-auto max-h-[90vh]"
    >
      <!-- Close Button -->
      <button
        id="close-modal"
        class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 text-2xl"
      >
        &times;
      </button>

      <!-- Title -->
      <h2 class="text-2xl font-bold mb-4 text-center">Hire Me</h2>

      <!-- Form -->
      <form id="hire-form" class="space-y-4">
        <input
          type="text"
          name="name"
          placeholder="Your Name"
          required
          class="w-full px-4 py-2 border rounded dark:bg-gray-800 dark:border-gray-700"
        />

        <input
          type="email"
          name="email"
          placeholder="Your Email"
          required
          class="w-full px-4 py-2 border rounded dark:bg-gray-800 dark:border-gray-700"
        />

        <textarea
          name="message"
          placeholder="Your Message"
          required
          class="w-full px-4 py-2 border rounded dark:bg-gray-800 dark:border-gray-700"
        ></textarea>

        <select
          name="plan"
          required
          class="w-full px-4 py-2 border rounded dark:bg-gray-800 dark:border-gray-700"
        >
          <option value="">Select a plan</option>
          <option value="basic">Basic</option>
          <option value="standard">Standard</option>
          <option value="custom">Custom</option>
          <option value="not-sure">Not Sure</option>
        </select>

        <button
          type="submit"
          class="w-full px-4 py-2 bg-[var(--accent-primary)] text-white rounded hover:bg-[var(--accent-secondary-hover)] transition"
        >
          Send
        </button>
      </form>
    </div>
  </div>
</div>


<script>
  const mobileToggle = document.getElementById("mobile-toggle");
  const mobileMenu = document.getElementById("mobile-menu");

  if (mobileToggle && mobileMenu) {
    mobileToggle.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    const html = document.documentElement;
    const toggles = document.querySelectorAll(".layout-switch");

    // Default layout
    if (!html.classList.contains("layout-light") && !html.classList.contains("layout-dark")) {
      html.classList.add("layout-light");
    }

    // Load saved layout
    const savedLayout = localStorage.getItem("layout");
    if (savedLayout) {
      html.classList.remove("layout-light", "layout-dark");
      html.classList.add(savedLayout);
    }

    function setLayout(isDark) {
      html.classList.remove("layout-light", "layout-dark");
      html.classList.add(isDark ? "layout-dark" : "layout-light");
      localStorage.setItem("layout", isDark ? "layout-dark" : "layout-light");
      toggles.forEach((t) => (t.checked = isDark));
    }

    // Sync toggle state & attach listeners
    toggles.forEach((toggle) => {
      toggle.checked = html.classList.contains("layout-dark");
      toggle.addEventListener("change", () => setLayout(toggle.checked));
    });
  });

  const form = document.getElementById("hire-form");
  const hireBtns = document.querySelectorAll(".hire-me");
  const modal = document.getElementById("hire-modal");
  const closeBtn = document.getElementById("close-modal");

  // Hide modal if switching between desktop/mobile menu
  function hideModalOnMenuChange() {
    if (modal && !modal.classList.contains("hidden")) {
      modal.classList.add("hidden");
    }
  }
  if (mobileToggle) {
    mobileToggle.addEventListener("click", hideModalOnMenuChange);
  }

  hireBtns.forEach((btn) => {
    btn.addEventListener("click", () => {
      if (modal) modal.classList.remove("hidden");
    });
  });

  if (closeBtn) {
    closeBtn.addEventListener("click", () => {
      if (modal) modal.classList.add("hidden");
    });
  }
  if (modal) {
    modal.addEventListener("click", (e) => {
      if (e.target === modal) modal.classList.add("hidden");
    });
  }

  if (form instanceof HTMLFormElement) {
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form).entries());
      try {
        const res = await fetch("/api/add-contact", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
        if (res.ok) {
          alert("Message sent successfully!");
          form.reset();
          if (modal) modal.classList.add("hidden");
        } else {
          alert("Something went wrong. Please try again.");
        }
      } catch (err) {
        console.error(err);
        alert("Network error.");
      }
    });
  }
</script>
